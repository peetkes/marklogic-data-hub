<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Upgrade to DHF 4.1.x / 4.2.x | marklogic-data-hub</title>
<meta property="og:title" content="Upgrade to DHF 4.1.x / 4.2.x" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A data hub framework for MarkLogic. Start here =&gt;" />
<meta property="og:description" content="A data hub framework for MarkLogic. Start here =&gt;" />
<meta property="og:site_name" content="marklogic-data-hub" />
<script type="application/ld+json">
{"name":null,"description":"A data hub framework for MarkLogic. Start here =&gt;","author":null,"@type":"WebPage","url":"/marklogic-data-hub/_pages/upgrade/upgrade-to-4_1_x-main","image":null,"publisher":null,"headline":"Upgrade to DHF 4.1.x / 4.2.x","dateModified":null,"datePublished":null,"sameAs":null,"mainEntityOfPage":null,"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link href="/marklogic-data-hub/assets/css/style.css?v=b512f130787b04bc1a24dcb13d9cbe59fce95f08" rel="stylesheet">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
        <h1><a href="/marklogic-data-hub/">marklogic-data-hub</a></h1>
      

      <h1 id="upgrade-to-dhf-41x--42x">Upgrade to DHF 4.1.x / 4.2.x</h1>

<h2 id="prerequisites">Prerequisites</h2>

<p>Data Hub Framework 4.1.0 / 4.2.x requires the following software:</p>

<ul>
  <li>
    <p>MarkLogic Server 9.0-5 or later</p>

    <ul>
      <li>
        <p>If you are upgrading both DHF and MarkLogic, you can upgrade them independently of each other as long as you are running at least the minimally supported version of MarkLogic Server for your current DHF version. (DHF versions from 2.0.4 to 4.1.0 require MarkLogic Server 9.0-5 or later.) If you are running an older version of MarkLogic Server, then you must upgrade MarkLogic Server before upgrading DHF.</p>
      </li>
      <li>
        <p>Deploying to the <strong>MarkLogic Data Hub Service</strong> requires DHF 4.0.1 or later and MarkLogic 9.0-7 or later. See the Data Hub Service <a href="https://www.marklogic.com/product/marklogic-database-overview/data-hub-service/">overview</a> and <a href="https://cloudservices.marklogic.com/help?type=datahub&amp;subtype=user">documentation</a>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Oracle Java 8 JRE</p>
  </li>
  <li>
    <p>For the QuickStart tool: A modern browser, such as Chrome or Firefox</p>
  </li>
</ul>

<div class="alert alert-info" role="alert">
<i class="fa fa-info-circle"></i>
<b>TIP:</b>
<span>Before any upgrade, back up your project or, if under source control, check in all changes.</span>
</div>

<h2 id="upgrade-notes-and-steps">Upgrade Notes and Steps</h2>

<!-- Tab links -->
<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'DHF403401to410')" id="defaultOpen">From 4.0.1+</button>
  <button class="tablinks" onclick="openTab(event, 'DHF400to410')">From 4.0.0</button>
  <button class="tablinks" onclick="openTab(event, 'DHF300204to410')">From 3.0.0 or 2.0.4+</button>
  <button class="tablinks" onclick="openTab(event, 'DHFpre204to410')">From earlier versions</button>
</div>
<!-- Tab content -->
<div id="DHF403401to410" class="tabcontent">

  <p>The notes and steps in this tab are for the following upgrade paths:</p>
  <ul>
    <li>DHF 4.0.3 » 4.1.x or 4.2.x</li>
    <li>DHF 4.0.2 » 4.1.x or 4.2.x</li>
    <li>DHF 4.0.1 » 4.1.x or 4.2.x</li>
  </ul>

  <h3 id="upgrade-notes">Upgrade Notes</h3>

  <ul>
    <li>
      <p>The <code class="highlighter-rouge">hubUpdate</code> task makes the following changes.</p>

      <ul>
        <li>
          <p>Archives existing configuration directories under <code class="highlighter-rouge">your-project-root/src/main</code>. (<em>4.0.x</em> is the old DHF version.)</p>

          <table class="table-b1gray">
            <thead>
              <tr>
                <th>old directory</th>
                <th>new archive directory</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code class="highlighter-rouge">hub-internal-config</code></td>
                <td><code class="highlighter-rouge">hub-internal-config-4.0.x</code></td>
              </tr>
              <tr>
                <td><code class="highlighter-rouge">ml-config</code></td>
                <td><code class="highlighter-rouge">ml-config-4.0.x</code></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>
          <p>Overwrites the existing databases, server directories, and the security directory.</p>
        </li>
      </ul>
    </li>
    <li>
      <p>Running the <code class="highlighter-rouge">hubUpdate</code> task with the <code class="highlighter-rouge">-i</code> option (info mode) displays specifically what the task does, including configuration settings that changed.</p>

      <details><summary><b>Example:</b> A verbose report.</summary>
  <pre>
  Upgrading entity-config dir
  Upgrading hub-internal-config dir
  Processing /your-project-root/hub-internal-config/databases/job-database.json
  Setting "schema-database" to "%%mlStagingSchemasDbName%%"
  Setting "triggers-database" to "%%mlStagingTriggersDbName%%"
  Adding path range indexes to job-database.json
  Writing /your-project-root/hub-internal-config/databases/job-database.json to /your-project-root/src/main/hub-internal-config/databases/job-database.json
  Processing /your-project-root/hub-internal-config/databases/final-database.json
  Setting "schema-database" to "%%mlFinalSchemasDbName%%"
  Setting "triggers-database" to "%%mlFinalTriggersDbName%%"
  Writing /your-project-root/hub-internal-config/databases/final-database.json to /your-project-root/src/main/ml-config/databases/final-database.json
  Processing /your-project-root/hub-internal-config/databases/staging-database.json
  Setting "schema-database" to "%%mlStagingSchemasDbName%%"
  Setting "triggers-database" to "%%mlStagingTriggersDbName%%"
  Writing /your-project-root/hub-internal-config/databases/staging-database.json to /your-project-root/src/main/hub-internal-config/databases/staging-database.json
  Writing /your-project-root/hub-internal-config/databases/modules-database.json to /your-project-root/src/main/ml-config/databases/modules-database.json
  Processing /your-project-root/hub-internal-config/servers/job-server.json
  Setting "url-rewriter" to "/data-hub/4/tracing/tracing-rewriter.xml"
  Writing /your-project-root/hub-internal-config/servers/job-server.json to /your-project-root/src/main/hub-internal-config/servers/job-server.json
  Writing /your-project-root/hub-internal-config/servers/final-server.json to /your-project-root/src/main/ml-config/servers/final-server.json
  Processing /your-project-root/hub-internal-config/servers/staging-server.json
  Setting "url-rewriter" to "/data-hub/4/rest-api/rewriter.xml"
  Setting "error-handler" to "/data-hub/4/rest-api/error-handler.xqy"
  Writing /your-project-root/hub-internal-config/servers/staging-server.json to /your-project-root/src/main/hub-internal-config/servers/staging-server.json
  Upgrading user-config dir
  </pre>
</details>
    </li>
  </ul>

  <h3 id="steps">Steps</h3>

  <ol class="ol-steps">
    <li>
      <p>In your <code class="highlighter-rouge">build.gradle</code> file, replace all occurrences of your old DHF version number with <code class="highlighter-rouge">4.1.0</code>.</p>

      <p><strong>Example:</strong> In the <code class="highlighter-rouge">plugins</code> section and the <code class="highlighter-rouge">dependencies</code> section,</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   plugins {
       id 'net.saliman.properties' versi Dn '1.4.6'
       id 'com.marklogic.ml-data-hub' version '4.1.0'
   }
   ...
   dependencies {
     compile 'com.marklogic:marklogic-data-hub:4.1.0'
     compile 'com.marklogic:marklogic-xcc:9.0.6'
   }
</code></pre></div>      </div>

      <p><!-- See build script. --></p>
    </li>
    <li>
      <p>At your project’s root folder, run the <code class="highlighter-rouge">hubUpdate -i</code> Gradle task.</p>

      <div class="code-tabs">
     <ul class="nav nav-tabs" role="tablist">
       <li role="presentation" class="active">
         <a role="tab" aria-controls="tab1-1" href="#tab1-1">Unix Systems</a>
       </li>
       <li role="presentation" class="">
         <a role="tab" aria-controls="tab2-1" href="#tab2-1">Windows</a>
       </li>
     </ul>
     <div class="tab-content">
       <div role="tabpanel" class="tab-pane active" id="tab1-1">
         <pre class="cmdline">./gradlew hubUpdate -i</pre>
       </div>
       <div role="tabpanel" class="tab-pane" id="tab2-1">
         <pre class="cmdline">gradlew.bat hubUpdate -i</pre>
       </div>
     </div>
   </div>
    </li>
    <li>
      <p>Edit your <code class="highlighter-rouge">gradle.properties</code> file, and add the following property.</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   mlDHFVersion=4.1.0
</code></pre></div>      </div>
    </li>
    <li>
      <p>In <code class="highlighter-rouge">your-project-root/src/main</code>, copy any custom database/server configurations from the archived configuration files to the new ones. (<em>4.0.x</em> is the old DHF version.)</p>

      <table class="table-b1gray">
        <thead>
          <tr>
            <th>copy from files in</th>
            <th>paste to files in</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="highlighter-rouge">hub-internal-config-4.0.x</code></td>
            <td><code class="highlighter-rouge">hub-internal-config</code></td>
          </tr>
          <tr>
            <td><code class="highlighter-rouge">ml-config-4.0.x</code></td>
            <td><code class="highlighter-rouge">ml-config</code></td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>
      <p>At your project’s root folder, run the <code class="highlighter-rouge">mlDeploy</code> Gradle task.</p>

      <div class="code-tabs">
     <ul class="nav nav-tabs" role="tablist">
       <li role="presentation" class="active">
         <a role="tab" aria-controls="tab1-2" href="#tab1-2">Unix Systems</a>
       </li>
       <li role="presentation" class="">
         <a role="tab" aria-controls="tab2-2" href="#tab2-2">Windows</a>
       </li>
     </ul>
     <div class="tab-content">
       <div role="tabpanel" class="tab-pane active" id="tab1-2">
         <pre class="cmdline">./gradlew mlDeploy</pre>
       </div>
       <div role="tabpanel" class="tab-pane" id="tab2-2">
         <pre class="cmdline">gradlew.bat mlDeploy</pre>
       </div>
     </div>
   </div>
    </li>
    <li>
      <p>Run your <a href="/marklogic-data-hub/ingest/">ingest</a> and <a href="/marklogic-data-hub/harmonize/">harmonize</a> flows.</p>
    </li>
  </ol>
</div>

<div id="DHF400to410" class="tabcontent">

  <p>The notes and steps in this tab are for the following upgrade paths:</p>
  <ul>
    <li>DHF 4.0.0 » 4.1.x or 4.2.x</li>
  </ul>

  <h3 id="upgrade-notes-1">Upgrade Notes</h3>

  <ul>
    <li>
      <p>DHF 4.0.0 is unique among DHF versions because it has two modules databases: one for the final app server/database and one for the staging app server/database. All other DHF versions before and after 4.0.0 have only one modules database. When upgrading to 4.1.0, those databases must be commented out in <code class="highlighter-rouge">gradle.properties</code>.</p>
    </li>
    <li>
      <p>The <code class="highlighter-rouge">hubUpdate</code> task makes the following changes.</p>

      <ul>
        <li>
          <p>Archives existing configuration directories under <code class="highlighter-rouge">your-project-root/src/main</code>.</p>

          <table class="table-b1gray">
            <thead>
              <tr>
                <th>old directory</th>
                <th>new archive directory</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code class="highlighter-rouge">hub-internal-config</code></td>
                <td><code class="highlighter-rouge">hub-internal-config-4.0.0</code></td>
              </tr>
              <tr>
                <td><code class="highlighter-rouge">ml-config</code></td>
                <td><code class="highlighter-rouge">ml-config-4.0.0</code></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>
          <p>Overwrites the existing databases, server directories, and the security directory.</p>
        </li>
      </ul>
    </li>
    <li>
      <p>Running the <code class="highlighter-rouge">hubUpdate</code> task with the <code class="highlighter-rouge">-i</code> option (info mode) displays specifically what the task does, including configuration settings that changed.</p>

      <details><summary><b>Example:</b> A verbose report.</summary>
  <pre>
  Upgrading entity-config dir
  Upgrading hub-internal-config dir
  Processing /your-project-root/hub-internal-config/databases/job-database.json
  Setting "schema-database" to "%%mlStagingSchemasDbName%%"
  Setting "triggers-database" to "%%mlStagingTriggersDbName%%"
  Adding path range indexes to job-database.json
  Writing /your-project-root/hub-internal-config/databases/job-database.json to /your-project-root/src/main/hub-internal-config/databases/job-database.json
  Processing /your-project-root/hub-internal-config/databases/final-database.json
  Setting "schema-database" to "%%mlFinalSchemasDbName%%"
  Setting "triggers-database" to "%%mlFinalTriggersDbName%%"
  Writing /your-project-root/hub-internal-config/databases/final-database.json to /your-project-root/src/main/ml-config/databases/final-database.json
  Processing /your-project-root/hub-internal-config/databases/staging-database.json
  Setting "schema-database" to "%%mlStagingSchemasDbName%%"
  Setting "triggers-database" to "%%mlStagingTriggersDbName%%"
  Writing /your-project-root/hub-internal-config/databases/staging-database.json to /your-project-root/src/main/hub-internal-config/databases/staging-database.json
  Writing /your-project-root/hub-internal-config/databases/modules-database.json to /your-project-root/src/main/ml-config/databases/modules-database.json
  Processing /your-project-root/hub-internal-config/servers/job-server.json
  Setting "url-rewriter" to "/data-hub/4/tracing/tracing-rewriter.xml"
  Writing /your-project-root/hub-internal-config/servers/job-server.json to /your-project-root/src/main/hub-internal-config/servers/job-server.json
  Writing /your-project-root/hub-internal-config/servers/final-server.json to /your-project-root/src/main/ml-config/servers/final-server.json
  Processing /your-project-root/hub-internal-config/servers/staging-server.json
  Setting "url-rewriter" to "/data-hub/4/rest-api/rewriter.xml"
  Setting "error-handler" to "/data-hub/4/rest-api/error-handler.xqy"
  Writing /your-project-root/hub-internal-config/servers/staging-server.json to /your-project-root/src/main/hub-internal-config/servers/staging-server.json
  Upgrading user-config dir
  </pre>
</details>
    </li>
  </ul>

  <h3 id="steps-1">Steps</h3>

  <ol class="ol-steps">
    <li>
      <p>In your <code class="highlighter-rouge">build.gradle</code> file, replace all occurrences of your old DHF version number with <code class="highlighter-rouge">4.1.0</code>.</p>

      <p><strong>Example:</strong> In the <code class="highlighter-rouge">plugins</code> section and the <code class="highlighter-rouge">dependencies</code> section,</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   plugins {
       id 'net.saliman.properties' versi Dn '1.4.6'
       id 'com.marklogic.ml-data-hub' version '4.1.0'
   }
   ...
   dependencies {
     compile 'com.marklogic:marklogic-data-hub:4.1.0'
     compile 'com.marklogic:marklogic-xcc:9.0.6'
   }
</code></pre></div>      </div>
    </li>
    <li>
      <p>At your project’s root folder, run the <code class="highlighter-rouge">hubUpdate -i</code> Gradle task.</p>

      <div class="code-tabs">
     <ul class="nav nav-tabs" role="tablist">
       <li role="presentation" class="active">
         <a role="tab" aria-controls="tab1-3" href="#tab1-3">Unix Systems</a>
       </li>
       <li role="presentation" class="">
         <a role="tab" aria-controls="tab2-3" href="#tab2-3">Windows</a>
       </li>
     </ul>
     <div class="tab-content">
       <div role="tabpanel" class="tab-pane active" id="tab1-3">
         <pre class="cmdline">./gradlew hubUpdate -i</pre>
       </div>
       <div role="tabpanel" class="tab-pane" id="tab2-3">
         <pre class="cmdline">gradlew.bat hubUpdate -i</pre>
       </div>
     </div>
   </div>
    </li>
    <li>
      <p>In <code class="highlighter-rouge">your-project-root/src/main</code>, copy any custom database/server configurations from the archived configuration files to the new ones.</p>

      <table class="table-b1gray">
        <thead>
          <tr>
            <th>copy from files in</th>
            <th>paste to files in</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="highlighter-rouge">hub-internal-config-4.0.0</code></td>
            <td><code class="highlighter-rouge">hub-internal-config</code></td>
          </tr>
          <tr>
            <td><code class="highlighter-rouge">ml-config-4.0.0</code></td>
            <td><code class="highlighter-rouge">ml-config</code></td>
          </tr>
        </tbody>
      </table>

      <p class="alert alert-info" role="alert">
<i class="fa fa-info-circle"> </i>
<b>IMPORTANT:</b>
<span>Do <strong>NOT</strong> copy any references to the staging(<code class="highlighter-rouge">%%mlStagingModulesDbName%%</code>) and final(<code class="highlighter-rouge">%%mlFinalModulesDbName%%</code>) modules databases. These settings are replaced in DHF 4.1.x with <code class="highlighter-rouge">%%mlModulesDbName%%</code>.</span></p>
    </li>
    <li>
      <p>Edit your <code class="highlighter-rouge">gradle.properties</code> file.</p>

      <p>a. Remove the following properties: <!-- What are the actual names? --></p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   mlStagingModulesDbName
   mlStagingModulesForestsPerHost
   mlStagingModulePermissions
   mlFinalModulesDbName
   mlFinalModulesForestsPerHost
   mlFinalModulePermissions
</code></pre></div>      </div>

      <p>b. Add the following properties and replace the values accordingly.</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   mlDHFVersion=4.1.0
   mlModulesDbName=data-hub-MODULES
   mlModulesForestsPerHost=1
</code></pre></div>      </div>
    </li>
    <li>
      <p>At your project’s root folder, run the <code class="highlighter-rouge">mlDeploy</code> Gradle task.</p>

      <div class="code-tabs">
     <ul class="nav nav-tabs" role="tablist">
       <li role="presentation" class="active">
         <a role="tab" aria-controls="tab1-4" href="#tab1-4">Unix Systems</a>
       </li>
       <li role="presentation" class="">
         <a role="tab" aria-controls="tab2-4" href="#tab2-4">Windows</a>
       </li>
     </ul>
     <div class="tab-content">
       <div role="tabpanel" class="tab-pane active" id="tab1-4">
         <pre class="cmdline">./gradlew mlDeploy</pre>
       </div>
       <div role="tabpanel" class="tab-pane" id="tab2-4">
         <pre class="cmdline">gradlew.bat mlDeploy</pre>
       </div>
     </div>
   </div>
    </li>
    <li>
      <p>Run your <a href="/marklogic-data-hub/ingest/">ingest</a> and <a href="/marklogic-data-hub/harmonize/">harmonize</a> flows.</p>

      <p>If you use <a href="https://docs.marklogic.com/guide/mlcp">MarkLogic Content Pump</a> for your input flows, run MLCP with the <code class="highlighter-rouge">-transform_module</code> option as follows:</p>

      <div class="code-tabs">
     <ul class="nav nav-tabs" role="tablist">
       <li role="presentation" class="active">
         <a role="tab" aria-controls="tab1-5" href="#tab1-5">XQuery plugin (.xqy)</a>
       </li>
       <li role="presentation" class="">
         <a role="tab" aria-controls="tab2-5" href="#tab2-5">JavaScript plugin (.sjs)</a>
       </li>
     </ul>
     <div class="tab-content">
       <div role="tabpanel" class="tab-pane active" id="tab1-5">
         <pre class="cmdline">-transform_module "/data-hub/4/transforms/mlcp-flow-transform.xqy"</pre>
       </div>
       <div role="tabpanel" class="tab-pane" id="tab2-5">
         <pre class="cmdline">-transform_module "/data-hub/4/transforms/mlcp-flow-transform.sjs"</pre>
       </div>
     </div>
   </div>
    </li>
  </ol>

  <h3 id="remarks">Remarks</h3>

  <p>After running <code class="highlighter-rouge">mlUndeploy</code>, delete the following obsolete resources:</p>
  <ul>
    <li>data-hub-staging-MODULES database and forest</li>
    <li>data-hub-final-MODULES database and forest</li>
  </ul>
</div>

<div id="DHF300204to410" class="tabcontent">

  <p>The notes and steps in this tab are for the following upgrade paths:</p>
  <ul>
    <li>DHF 3.0.0 » 4.1.x or 4.2.x</li>
    <li>DHF 2.0.6 » 4.1.x or 4.2.x</li>
    <li>DHF 2.0.5 » 4.1.x or 4.2.x</li>
    <li>DHF 2.0.4 » 4.1.x or 4.2.x</li>
  </ul>

  <h3 id="upgrade-notes-2">Upgrade Notes</h3>

  <ul>
    <li>
      <p>The <code class="highlighter-rouge">hubUpdate</code> Gradle task makes the following changes.</p>

      <ul>
        <li>
          <p>Renames old configuration directories under your project root.</p>

          <table class="table-b1gray">
            <thead>
              <tr>
                <th>old directory</th>
                <th>new directory</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code class="highlighter-rouge">hub-internal-config</code></td>
                <td><code class="highlighter-rouge">hub-internal-config.old</code></td>
              </tr>
              <tr>
                <td><code class="highlighter-rouge">user-config</code></td>
                <td><code class="highlighter-rouge">user-config.old</code></td>
              </tr>
              <tr>
                <td><code class="highlighter-rouge">entity-config</code></td>
                <td><code class="highlighter-rouge">entity-config.old</code></td>
              </tr>
            </tbody>
          </table>
        </li>
        <li>
          <p>Creates the new project directory structure (<code class="highlighter-rouge">your-project-root/src/main</code> and its subdirectories) and new files.</p>
        </li>
        <li>
          <p>Copies some settings from the old configuration files to the new ones.</p>
        </li>
        <li>
          <p>Updates all flows to use updated imports. See the [notes to upgrade to 4.0.0] ](https://marklogic.github.io/marklogic-data-hub/upgrade/upgrade-to-4_0_x/#upgrading-from-204-to-40x).</p>
        </li>
      </ul>
    </li>
    <li>
      <p>Running the <code class="highlighter-rouge">hubUpdate</code> task with the <code class="highlighter-rouge">-i</code> option (info mode) displays specifically what the task does, including configuration settings that changed.</p>

      <details><summary><b>Example:</b> A verbose report.</summary>
  <pre>
  Upgrading entity-config dir
  Upgrading hub-internal-config dir
  Processing /your-project-root/hub-internal-config/databases/job-database.json
  Setting "schema-database" to "%%mlStagingSchemasDbName%%"
  Setting "triggers-database" to "%%mlStagingTriggersDbName%%"
  Adding path range indexes to job-database.json
  Writing /your-project-root/hub-internal-config/databases/job-database.json to /your-project-root/src/main/hub-internal-config/databases/job-database.json
  Processing /your-project-root/hub-internal-config/databases/final-database.json
  Setting "schema-database" to "%%mlFinalSchemasDbName%%"
  Setting "triggers-database" to "%%mlFinalTriggersDbName%%"
  Writing /your-project-root/hub-internal-config/databases/final-database.json to /your-project-root/src/main/ml-config/databases/final-database.json
  Processing /your-project-root/hub-internal-config/databases/staging-database.json
  Setting "schema-database" to "%%mlStagingSchemasDbName%%"
  Setting "triggers-database" to "%%mlStagingTriggersDbName%%"
  Writing /your-project-root/hub-internal-config/databases/staging-database.json to /your-project-root/src/main/hub-internal-config/databases/staging-database.json
  Writing /your-project-root/hub-internal-config/databases/modules-database.json to /your-project-root/src/main/ml-config/databases/modules-database.json
  Processing /your-project-root/hub-internal-config/servers/job-server.json
  Setting "url-rewriter" to "/data-hub/4/tracing/tracing-rewriter.xml"
  Writing /your-project-root/hub-internal-config/servers/job-server.json to /your-project-root/src/main/hub-internal-config/servers/job-server.json
  Writing /your-project-root/hub-internal-config/servers/final-server.json to /your-project-root/src/main/ml-config/servers/final-server.json
  Processing /your-project-root/hub-internal-config/servers/staging-server.json
  Setting "url-rewriter" to "/data-hub/4/rest-api/rewriter.xml"
  Setting "error-handler" to "/data-hub/4/rest-api/error-handler.xqy"
  Writing /your-project-root/hub-internal-config/servers/staging-server.json to /your-project-root/src/main/hub-internal-config/servers/staging-server.json
  Upgrading user-config dir
  </pre>
</details>
    </li>
    <li>
      <p>If custom configurations (i.e., from <code class="highlighter-rouge">user-config</code>) are missing, you must manually copy them to <code class="highlighter-rouge">ml-config</code>.</p>
    </li>
    <li>
      <p>Because DHF 3.0.0 and DHF 2.0.4+ had only a single schemas database and a single triggers database, you must decide whether to use those existing databases as the staging databases or as the final databases in DHF 4.1.0. The settings in <code class="highlighter-rouge">gradle.properties</code> (and possibly other configurations) depend on your decision.</p>

      <table class="table-b1gray">
        <thead>
          <tr>
            <th>DHF 3.0.0 and 2.0.4+</th>
            <th>DHF 4.x</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code class="highlighter-rouge">data-hub-SCHEMAS</code> database</td>
            <td><code class="highlighter-rouge">data-hub-staging-SCHEMAS</code> database<br /><code class="highlighter-rouge">data-hub-final-SCHEMAS</code> database</td>
          </tr>
          <tr>
            <td><code class="highlighter-rouge">data-hub-TRIGGERS</code> dtabase</td>
            <td><code class="highlighter-rouge">data-hub-staging-TRIGGERS</code> database<br /><code class="highlighter-rouge">data-hub-final-TRIGGERS</code> database</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ul>

  <!--
- In 4.0.0, the return type for plugins was changed to `objectNode()`. If your custom plugins contains lines that convert a plugin parameter using `.toObject()`, those lines of code must be removed or commented out.

    **Examples:**
        - `content = content.toObject()` in header.sjs under input directory
        - `envelope = envelope.toObject()` in writer.sjs under harmonize directory
-->

  <h3 id="steps-2">Steps</h3>

  <ol class="ol-steps">
    <li>
      <p>In your <code class="highlighter-rouge">build.gradle</code> file, replace all occurrences of your old DHF version number with <code class="highlighter-rouge">4.1.0</code>.</p>

      <p><strong>Example:</strong> In the <code class="highlighter-rouge">plugins</code> section and the <code class="highlighter-rouge">dependencies</code> section,</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   plugins {
       id 'net.saliman.properties' versi Dn '1.4.6'
       id 'com.marklogic.ml-data-hub' version '4.1.0'
   }
   ...
   dependencies {
     compile 'com.marklogic:marklogic-data-hub:4.1.0'
     compile 'com.marklogic:marklogic-xcc:9.0.6'
   }
</code></pre></div>      </div>
    </li>
    <li>
      <p>At your project’s root folder, run the <code class="highlighter-rouge">hubUpdate -i</code> Gradle task.</p>

      <div class="code-tabs">
     <ul class="nav nav-tabs" role="tablist">
       <li role="presentation" class="active">
         <a role="tab" aria-controls="tab1-6" href="#tab1-6">Unix Systems</a>
       </li>
       <li role="presentation" class="">
         <a role="tab" aria-controls="tab2-6" href="#tab2-6">Windows</a>
       </li>
     </ul>
     <div class="tab-content">
       <div role="tabpanel" class="tab-pane active" id="tab1-6">
         <pre class="cmdline">./gradlew hubUpdate -i</pre>
       </div>
       <div role="tabpanel" class="tab-pane" id="tab2-6">
         <pre class="cmdline">gradlew.bat hubUpdate -i</pre>
       </div>
     </div>
   </div>
    </li>
    <li>
      <p>Edit your <code class="highlighter-rouge">gradle.properties</code> file.</p>

      <p>a. Remove the following properties: <!-- What are the actual names? --></p>

      <ul>
        <li>data-hub-TRACING server</li>
        <li>data-hub-TRACING database</li>
        <li>data-hub-TRIGGERS database</li>
        <li>data-hub-SCHEMAS database</li>
      </ul>

      <p>b. Add the following properties and replace the values accordingly.</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   mlDHFVersion=4.1.0
   mlStagingTriggersDbName=data-hub-staging-TRIGGERS
   mlStagingTriggersForestsPerHost=1
   mlStagingSchemasDbName=data-hub-staging-SCHEMAS
   mlStagingSchemasForestsPerHost=1
   mlFinalTriggersDbName=data-hub-final-TRIGGERS
   mlFinalTriggersForestsPerHost=1
   mlFinalSchemasDbName=data-hub-final-SCHEMAS
   mlFinalSchemasForestsPerHost=1
   mlHubAdminRole=hub-admin-role
   mlHubAdminUserName=hub-admin-user
</code></pre></div>      </div>

      <p>c. Add default modules permissions.</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   mlModulePermissions=rest-reader,read,rest-writer,insert,rest-writer,update,rest-extension-user,execute,data-hub-role,read,data-hub-role,execute
</code></pre></div>      </div>
    </li>
    <li>
      <p>At your project’s root folder, run the <code class="highlighter-rouge">mlDeploy</code> Gradle task.</p>

      <div class="code-tabs">
     <ul class="nav nav-tabs" role="tablist">
       <li role="presentation" class="active">
         <a role="tab" aria-controls="tab1-7" href="#tab1-7">Unix Systems</a>
       </li>
       <li role="presentation" class="">
         <a role="tab" aria-controls="tab2-7" href="#tab2-7">Windows</a>
       </li>
     </ul>
     <div class="tab-content">
       <div role="tabpanel" class="tab-pane active" id="tab1-7">
         <pre class="cmdline">./gradlew mlDeploy</pre>
       </div>
       <div role="tabpanel" class="tab-pane" id="tab2-7">
         <pre class="cmdline">gradlew.bat mlDeploy</pre>
       </div>
     </div>
   </div>
    </li>
    <li>
      <p>Run your <a href="/marklogic-data-hub/ingest/">ingest</a> and <a href="/marklogic-data-hub/harmonize/">harmonize</a> flows.</p>

      <p>If you use <a href="https://docs.marklogic.com/guide/mlcp">MarkLogic Content Pump</a> for your input flows, run MLCP with the <code class="highlighter-rouge">-transform_module</code> option as follows:</p>

      <div class="code-tabs">
     <ul class="nav nav-tabs" role="tablist">
       <li role="presentation" class="active">
         <a role="tab" aria-controls="tab1-8" href="#tab1-8">XQuery plugin (.xqy)</a>
       </li>
       <li role="presentation" class="">
         <a role="tab" aria-controls="tab2-8" href="#tab2-8">JavaScript plugin (.sjs)</a>
       </li>
     </ul>
     <div class="tab-content">
       <div role="tabpanel" class="tab-pane active" id="tab1-8">
         <pre class="cmdline">-transform_module "/data-hub/4/transforms/mlcp-flow-transform.xqy"</pre>
       </div>
       <div role="tabpanel" class="tab-pane" id="tab2-8">
         <pre class="cmdline">-transform_module "/data-hub/4/transforms/mlcp-flow-transform.sjs"</pre>
       </div>
     </div>
   </div>
    </li>
  </ol>

  <h3 id="remarks-1">Remarks</h3>

  <p>Before running <code class="highlighter-rouge">mlUndeploy</code>, delete the resources associated with the properties that were removed from the <code class="highlighter-rouge">gradle.properties</code> file:</p>

  <ul>
    <li>data-hub-TRACING server</li>
    <li>data-hub-TRACING database</li>
    <li>data-hub-TRIGGERS database</li>
    <li>data-hub-SCHEMAS database</li>
  </ul>

  <!-- To undeploy, "./gradlew mlUndeploy -Pconfirm=true" -->
</div>

<div id="DHFpre204to410" class="tabcontent">

  <p>The notes and steps in this tab are for the following upgrade paths:</p>
  <ul>
    <li>DHF 2.0.3 and earlier versions » 4.1.x or 4.2.x</li>
  </ul>

  <h3 id="steps-3">Steps</h3>

  <ol class="ol-steps">
    <li>Upgrade to <a href="https://github.com/marklogic/marklogic-data-hub/releases/tag/v.2.0.6">DHF 2.0.6</a>.</li>
    <li>Follow the steps to upgrade from 3.0.0 or 2.0.4+ to DHF 4.1.0.</li>
  </ol>
</div>

<h2 id="see-also">See Also</h2>
<ul>
  <li><a href="/marklogic-data-hub/release-notes/release-notes-4_1_x/">Release Notes for DHF 4.1.0</a></li>
  <li><a href="https://github.com/marklogic/marklogic-data-hub/releases/tag/4.1.0">Download DHF 4.1.0.</a></li>
</ul>


      
      <div class="footer border-top border-gray-light mt-5 pt-3 text-right text-gray">
        This site is open source. <a href="http://github.com/marklogic/marklogic-data-hub/edit/gh-pages/_pages/upgrade/upgrade-to-4_1_x-main.md">Improve this page</a>.
      </div>
      
    </div>
    <script src="/marklogic-data-hub/assets/javascript/anchor-js/anchor.min.js"></script>
    <script>anchors.add();</script>
  </body>
</html>
